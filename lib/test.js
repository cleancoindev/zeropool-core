const { ethPrivateKey, zpMnemonic, contractAddress } = require('./init-env');
const ZeroPoolNetwork = require('./zero-pool-network');
const { MerkleTree } = require('./../circom/src/merkletree');
const poseidon = require("circomlib/src/poseidon");
const { utxo } = require("../circom/src/inputs");
const { bn128 } = require("snarkjs");


// to test you should uncomment it
// depositCancel()
// deposit()
//
// 'https://rinkeby.infura.io/v3/826fec4cbd954dfd89c714eabf4611c4'
const zp = new ZeroPoolNetwork(contractAddress, ethPrivateKey, zpMnemonic);

zp.deposit("0x0000000000000000000000000000000000000000", 10 ** 5)
  .then(e => console.log(JSON.stringify(e)))

const blockItem = { deposit_blocknumber: '0x0',
  proof:
    [ '0x1374d1b270ca95940ba8d93db79328fefa3a3b74853847bc7b1fa806487c681e',
      '0x1d7807dee0d6a5e792893ed4d22ed92d2e3aa09da6ce2d7d666cb0e194f594a2',
      '0x2e42d81853dce3fd663e646b34eaebe9fc505fc559fb8a9bce0277be07557fa6',
      '0x2eeed6441076c8177f799644bcee08a62548dd20cdf1cd3342a2dc2e1738758a',
      '0x11f72d7b7e7ed45665b531caa6e6007d5785dc5eb89c8a65c3a8b10b595354e3',
      '0x29d0b537bdb2f61eb18334aaa8347871252d1f53f8b92eb2a55787c899d7fd45',
      '0x22e36bce7c32dbcda9375200432f1a99bd85864100c249c74b70279d2bfb0d39',
      '0x111a015f634ff8dc1c27d5ae5d827b9bf794866385797fa534c56ea384bf8658' ],
  message1:
    [ '0x2aedaa652fe364ad3e0aaf045fc9c1ababa2c0626a544f7b6aa61df9d9945740',
      '0xacaca0bd3dc77f78d743f222251fceee70db795fcfbb4594e91ddca08439589',
      '0x1b299c8be67047e901bdae196bdbe9913ab36bcb6ae4bc9f262fbdf06dececf5',
      '0x4e37acadff79a798e6e37871f32fdaa8fee4b6d57871ca1d38c4bb3d1391e688' ],
  message2:
    [ '0x1977f91a6938d2df22541e2aa26dc13d1b2a1e303c232a11a94e00c1d2d3c24a',
      '0xfb0b093900fcd24fd21c4f70f002ee6179cb6754dabd70e73f9247f3dca2303',
      '0x20c9401ea9ff50782eb22abfe82edc4036f72a1ddd2f71bfbae02b8839908893',
      '0x2d12a129e0433abc0739897840678500a2db9aa0f0efaa667b96a84c70fc7c8d' ],
  owner: '0x0000000000000000000000000000000000000000',
  delta: '0x0',
  token: '0x0000000000000000000000000000000000000000',
  utxo:
    [ '0x1570f7bc116cfa0fba18ea722fe2125044276f7c05fe0c67693c88159127bd8e',
      '0x1086303455a829176ca1d6769fc337d79e95019001cf83477b960c6b9644ed2e' ],
  nullifier:
    [ '0x84058d35f820e21dd1a1c0ce3e915e770ada3fdf9018820ed4b1e253d012a6f',
      '0x266ed2b4900f94044e06f117adffeb249015a297242a9167097a61f4c090398e' ],
  rootptr: '0x5',
  new_root:
    '0x169641b3303a13d8cf68d6e3dee8a4f73cc33f257e856e9ce828a66643d286a9' }






//
// zp.publishBlockItems([blockItem], 5000000000).then(console.log)

//
// zp.utxoRootHash()
//   .then(console.log)
//

const utxo_in = [ { token: 0n,
  amount: 100000n,
  pubkey:
    3921759318078304940240630481871458028685446345187641628993654767663214110696n,
  blinding:
    10197655725858786741657159567990239630525907586552606399601389822037397723414n,
  mp_sibling:
    [ 9082332850789058232608053699220127647760141563910762910933265752533634430236n,
      8605668204894252018421565141414078287846780277086103410231889459318478755022n,
      17325516636655203304685357446470211555866789883064202373892151823301208051968n,
      15362496748596162224562673039646463735701166694902230246191366360084089741808n,
      3171421283011099678172213181064215781395844368275901880503819278767032266053n,
      811463681839953651777473541765908085536220022209428190504815069489494010885n,
      13064558374208152162708697998995611495305529433229206948157197076451175327959n,
      7311503910832266130755624400428811561405414443392140543102318211775248233362n,
      17002201217364759451217610853591697968986488295235380974427951403550807321707n,
      3500442693561461904038125704341979247251580107582557078642280160477539792818n,
      10501656479781836719197170875200353438080615205837812789201747535798868006609n,
      12914839239293365621585921068127683428941648179795690273965418411181646964415n,
      12492880136601929540904754914885001782263519525598738093563325262150635302360n,
      17936846559010455689227552817658893787011739602623722562423495781781027896246n,
      13121683564499582125450586031954700642263221699331733123771659586379936915090n,
      2151306395078888140082390342396672064177601520918049536222458442287316625149n,
      973981158916562824715210270245787078520087699511931306830353220473866989272n,
      12898540022437736719586872477129837513582070640020546314181205384805761992552n,
      10735091884781591299635655521928651084111810461354093711649475411912469649843n,
      13327530160302227271697984708670609451674249054901805775401956241509057418700n,
      15986313087792016329347698116251406749758077340959961537937482287420481099813n,
      21663645665006187845941287869331227818803254029633093035761111206856504590873n,
      6894123801651624732464317171894904979383696323335879951392387189806360479396n,
      3143742548657777282352720086119375615149853609086256306717859951072208904762n,
      11576922831286256560284620841077464395695347730830789665177223146385642313483n,
      19618776947554247327503805715555642544618369397629233982225982437668900848680n,
      2957506134981379138072587707549241847260360051372092991593286757652107999695n,
      5535857054133359989943183856109469945469070067054831224622465697587699586741n,
      21754553799146747998207416465892208719427900803102670069027925178357742398193n,
      19775312519358466453604956678080879392589515452908593006741652198244393197561n,
      13238170592610231769082643290569709711316545507151657257788487738181309369115n,
      414462044381848533880208748926423808039968765845791454432677987651222650587n ],
  mp_path: 2,
  blocknumber: 159 } ]


// const toToken = 0n;
// const toAmount = 0n;
// const toPubkey = 12123946667276826336013985323462868612130966473467100169422703722373267055672n;
// //
// const utxo_out = [utxo(toToken, toAmount, toPubkey)];
//

const token = "0x0000000000000000000000000000000000000000";


// zp.prepareWithdraw(token, 1)
//   .then(e => console.log(e));

// todo: parse transactions
zp.withdraw({
  token,
  amount: 10 ** 5,
  owner: zp.ethAddress,
  blocknumber: 168,
  txhash: "0xc68eca23f89667fd80105d1d7e9c7a087297a7ce701d11e50109e5dd66d9ad98"
}).then(console.log);
//
// zp.myUtxos()
//   .then(console.log)

// zp.getBalance()
//   .then(console.log)

// zp.transfer(token, "0x8aba319d7609671a719e30fee2b7c74631ac2ebbb19676510268f64bcae27e8", 102)
//   .then(e => console.log(e));

//
// //
// zp.myDeposits()
//   .then(async deposits => {
//     console.log(deposits)
//     // return zp.depositCancel(deposits[0])
//   }).then(console.log)



